FROM openjdk:8-jdk-slim

# Instalar dependencias
RUN apt-get update && apt-get install -y \
    wget \
    curl \
    ssh \
    rsync \
    && rm -rf /var/lib/apt/lists/*

# Variables de entorno
ENV HADOOP_VERSION=3.2.1
ENV PIG_VERSION=0.17.0
ENV HADOOP_HOME=/opt/hadoop
ENV PIG_HOME=/opt/pig
ENV JAVA_HOME=/usr/local/openjdk-8
ENV PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$PIG_HOME/bin

# Descargar e instalar Hadoop
RUN wget -q https://archive.apache.org/dist/hadoop/common/hadoop-$HADOOP_VERSION/hadoop-$HADOOP_VERSION.tar.gz && \
    tar -xzf hadoop-$HADOOP_VERSION.tar.gz && \
    mv hadoop-$HADOOP_VERSION $HADOOP_HOME && \
    rm hadoop-$HADOOP_VERSION.tar.gz

# Descargar e instalar Pig
RUN wget -q https://archive.apache.org/dist/pig/pig-$PIG_VERSION/pig-$PIG_VERSION.tar.gz && \
    tar -xzf pig-$PIG_VERSION.tar.gz && \
    mv pig-$PIG_VERSION $PIG_HOME && \
    rm pig-$PIG_VERSION.tar.gz

# Configurar Hadoop
COPY hadoop-config/* $HADOOP_HOME/etc/hadoop/

# Crear directorios necesarios
RUN mkdir -p /scripts /input /output

# Establecer directorio de trabajo
WORKDIR /scripts

# Comando por defecto
CMD ["bash"]